\chapter{Loop Agreement Tasks}
\section{Definition and Examples}
\emph{Loop agreement tasks} form a class of tasks in the sense of
\cref{ch1:def:taskprotocol}. They are related to loops in topolgical spaces
and in fact our main result in this chapter \pcref{ch3:classification}
connects the sovability of one such task through another with the
\emph{fundamental groups} of the (geometric realizations of the)
involved complexes. We start with the definition of a combinatorical
model of loops:

\begin{thDef}[walk, path, cycle]
    Let $K$ be a simplicial complex.
    \begin{itemize}
        \item
            A \emph{walk in $K$} is a tuple $w = (v_0,\dots,v_n)$
            where $n\in\N$ and $v_0,\dots,v_n$ are vertices
            of~$K$ such that $\{v_j,v_{j+1}\}$ is a $1$-simplex of~$K$
            (called an \emph{edge of $w$}) for all $j\in\setZeroto{n-1}$.
            
        \item
            A \emph{(simple) path in $K$} is a walk in~$K$ such that the
            vertices of the walk are pairwise distinct.
            
        \item
            A \emph{cycle in $K$} is a walk $(v_0,\dots,v_n)$ in~$K$ such that
            $n\in\N[\geq2]$, $v_0 = v_n$ and $(v_0,\dots,v_{n-1})$ is a path.
    \end{itemize}
\end{thDef}

Our terminology concides with the typical definitions found in an introduction
to graph theory and as a matter of fact the above definition is just a
restatement of the classical terms in the context of the graph~$K^{\leq 1}$.

\begin{thDef}[composition of walks]
    Let $K$ be a simplicial complex.
    \begin{itemize}
        \item
            If $w = (v_0,\dots,v_n)$ is a walk in~$K$, we denote by
            $\dot w \defeq v_0$ and $\ddot w \defeq v_n$ the first and
            last vertex of~$w$, respectively.
            
        \item
            Let $k\in\N[\geq1]$ and let $w_1,\dots,w_k$ be walks in~$K$
            where $w_j = (v_{j,0}, \dots, v_{j,n_j})$ for all $j\in\setOneto{k}$.
            We say $w_1\ast\dots\ast w_k$ is a \emph{valid composition}
            if $\ddot{w}_j = \dot{w}_{j+1}$ for all $j\in\setOneto{k-1}$ and
            in that case we define the \emph{composition of $w_1,\dots,w_k$}
            as the walk
            \[ w_1\ast\dots\ast w_k
                \defeq (v_{1,0},\dots,v_{1,n_1-1},
                        \dots,
                        v_{k-1,0},\dots,v_{k-1,n_{k-1}-1},
                        v_{k,0},\dots,v_{k,n_k})
            . \]
    \end{itemize}
\end{thDef}

\begin{thDef}[triangle loop]
    Let $K$ be a simplicial complex.
    A \emph{triangle loop in $K$} is a triple $\kappa = (p_0,p_1,p_2)$ of paths
    in~$K$ such that $p_0\ast p_1\ast p_2$ is a valid composition and a cycle
    in~$K$. In that case we call $\dot{p}_0,\dot{p}_1,\dot{p}_2$ the
    \emph{distinguished vertices} and $\dot\kappa \defeq \dot{p}_0$ the
    \emph{base point} of~$\kappa$.
\end{thDef}

Given a triangle loop in~$K$, this loop gives rise to a distributed task:
the processes are assigned input values that correspond to the distinguished
vertices of the loop and the output configuration has to be a simplex of~$K$
that \enquote{lies (on the path) between the input vertices}. We shall make this
precise soon, but first we introduce some useful conventions.

\begin{thConvention}\hfill
    \begin{itemize}
        \item
            In the following, we identify the abstract complex (corresponding to
            the complex obtained by the standard simplex) $\Delta^2$ with
            $\Pot(\{0,1,2\})$.
            % TODO: ^  check against chap1 if this is a repetition
            For convenience, we also denote its $1$-skeleton by
            $\partial\Delta^2$.
            
        \item
            Let $K$ be a simplicial complex and let $\ppp$ be a triangle loop
            in~$K$. For $j\in\{0,1,2\}$ the subcomplex of~$K$ determined
            by~$p_j$ is denoted $K(p_j)$; more precisely: $K(p_j)$ is the
            smallest subcomplex of~$K$ containing all edges of~$p_j$.
            
        \item
            Let $\finSimp$ denote the full subcategory of $\Simp_2$ that has
            \emph{finite connected $2$-dimensional simplicial complexes} as its
            objects.
    \end{itemize}
\end{thConvention}

\begin{thDef}[loop agreement task]
    Let $K\in\finSimp$ and let $\kappa = \ppp$ be a triangle loop in~$K$. The
    associated \emph{loop agreement task $\Loop{K,\kappa}\colon\Delta^2 \to K$}
    is defined as:
    \[
        F \mapsto \begin{cases}
            \{\dot{p}_j\} &\quad \text{if } F = \{j\},   \\
            K(p_0)        &\quad \text{if } F = \{0,1\}, \\
            K(p_1)        &\quad \text{if } F = \{1,2\}, \\
            K(p_2)        &\quad \text{if } F = \{0,2\}, \\
            K             &\quad \text{if } F = \{0,1,2\}
        . \end{cases}
    \]
\end{thDef}

Our informal description above has an exact interpretation now: if the input
configuration is, say, $\{0,1\}\in\Delta^2$, the output configuration has to
be a simplex of $K(p_0)\subset K$, that is a vertex or edge of the given
path~$p_0$ in~$K$.

\begin{thExample}[$(3,2)$-set agreement as loop agreement task]
    As a first but important example, we observe that the
    $(3,2)$-set agreement task \pcref{ch1:setagreement}
    \[ \skel^1\colon\Delta^2\to\partial\Delta^2 \]
    is the same as the loop agreement task
    \[ \Loop{\partial\Delta^2,\,\kappa}
        \qtextq{for}
        \kappa = \bigl( (0,1),\, (1,2),\, (2,0) \bigr)
    . \]
\end{thExample}

\begin{thExample}[$2$-dim. barycentric agreement as loop agreement task]
    Let $N\in\N$. Let $p_0$ be the unique path from $\sd_{\Delta^2}^N(\{0\})$
    to $\sd_{\Delta^2}^N(\{1\})$ in $\sd_{\Delta^2}^N(\{0,1\})$ and let
    $p_1,p_2$ be defined analogously. Then the barycentric agreement task
    \[ \sd_{\Delta^2}^N\colon \Delta^2 \to \sd^N \Delta^2 \]
    is the same as the loop agreement task
    \[ \Loop{\sd^N\!\Delta^2, \; (p_0,p_1,p_2)}  . \]
\end{thExample}

Some more examples can be found in the book by
Herlihy et~al.~\cite[Sec.~5.6.3]{bookc:herlihyetal13}.

\section{Topological Aspects}
In this section we define an \emph{algebraic signature} of a loop agreement task
based on the \emph{fundamental group} of its simplicial complex's geometric
realization. We also show that every homomorphism between fundamental groups
of $2$-dimensional finite simplicial complexes  % TODO: is "finite" necessary!?
is in fact induced by a continuous map and how that affects \emph{maps between
algebraic signatures}.
% TODO: ^  sounds awkward -.-

\begin{thDef}[topological loop associated to a triangle loop]
    Let $K\in\finSimp$.
    \begin{itemize}
        \item
            Let $c=(v_0,\dots,v_n)$ be a cycle in~$K$ and for
            $j\in\setZeroto{n-1}$ let $i_j\colon\Delta^1\to\geom K$ be the
            canonical inclusion of the geometric $1$-Simplex corresponding to
            the $1$-Simplex $\{v_j,v_{j+1}\}$ of~$K$.
            The \emph{(topological) loop~$\gamma_c$ associated to~$c$} is the
            (well-defined) injective continuous map
            \[
                S^1\to\geom K, \quad
                [t]\mapsto i_j(1-\tau,\tau) \qtextq{for} \tau=tn-j,
                    \qtextq{if} t\in\bigl[\tfrac{j}{n}, \tfrac{j+1}{n}\bigr]
            . \]
            
        \item
            Let $\kappa=\ppp$ be a triangle loop in~$K$. The \emph{(topolgical)
            loop~$\gamma_\kappa$ associated to~$\kappa$} is
            \[ \gamma_\kappa \defeq \gamma_{p_0\ast p_1\ast p_2}  . \]
    \end{itemize}
\end{thDef}

\begin{thConvention}[fundamental group of a complex]
    Let $K$ be a simplicial complex and let $v$ be a vertex of~$K$.
    We write
    \[ \pi_1(K,v) \defeq \pi_1(\geom K, \geom v) \]
    for the \emph{fundamental group of~$\geom K$ based at~$\geom v$}.
    % and conveniently call this the \emph{fundamental group of~$K$ based at~$v$}.
\end{thConvention}

\begin{thDef}[algebraic signature]
    Let $K\in\finSimp$ and let $\kappa$ be a triangle loop in~$K$. The
    \emph{algebraic signature of the loop agreement task~$\Loop{K,\kappa}$}
    is the pair
    \[ \bigl( \pi_1(K,\dot\kappa), \, [\gamma_\kappa]_\ast \bigr) . \]
    Let $L\in\finSimp$ be another complex and let $\lambda$ be a triangle loop
    in~$L$. If $\phi\colon\pi_1(K,\dot\kappa)\to\pi_1(L,\dot\lambda)$ is a
    group homomorphism that maps $[\gamma_\kappa]_\ast$ to
    $[\gamma_\lambda]_\ast$ we call
    \[ \phi\colon \bigl( \pi_1(K,\dot\kappa), \, [\gamma_\kappa]_\ast \bigr)
        \to \bigl( \pi_1(L,\dot\lambda), \, [\gamma_\lambda]_\ast \bigr)
    \]
    a \emph{map of algebraic signatures}.
\end{thDef}

In general, a group homorphism between fundamental groups of topolgical spaces
need note be induced by a continuous map. For finite simplicial complexes,
however, we have the following

\begin{thLemma}[contiuous realization of homomorphism]
    Let $K,L$ be finite connected simplicial complexes with $\dim(K)\leq 2$,
    let $x$ and~$y$ be vertices of $K$ and~$L$, respectively, and let
    $\phi\colon\pi_1(K,x)\to\pi_1(L,y)$ be a group homomorphism. Then there
    exists a continuous map $f\colon(\geom K,\geom x)\to(\geom L, \geom y)$
    of pointed spaces such that $\pi_1(f) = \phi$.
\end{thLemma}

\begin{proof}
    Let $K^\ast$ be a spanning tree of the graph~$K^{\leq 1}$ and let
    $x_0\defeq\geom x\in\geom K$. Then $\geom{K^\ast} \subset \geom K$ is
    contractible
    and since the inclusion of a subcomplex is a cofibration % TODO: ref
    this implies that the quotient map
    $q\colon \geom K \to \geom K / \geom{K^\ast} \eqdef X$
    is a homotopy equivalence. Let
    \[ \psi \defeq \phi\after\pi_1(q)^{-1}\colon
        \pi_1(X,[x_0]) \to \pi_1(L,y)
    \]
    and let $X^1 \defeq q(\geom{K^{\leq 1}})$. Clearly, since $K^\ast$ was a
    spanning tree, all vertices of~$K$ are identified in~$X^1$ and therefore
    \[ X^1 \cong \bigvee\nolimits^k S^1  , \]
    where $k\in\N$ is the number of $1$-simplices of~$K$ not contained
    in~$K^\ast$. For $j\in\setOneto k$ let $\gamma_j\colon S^1\to X^1$
    be the inclusion of the $j$-th loop into this wedge sum, and let
    $[\eta_j]_\ast \defeq \psi([\gamma_j]_\ast)$. Then the loops
    $\eta_j\colon (S^1,[0])\to(\geom L,\geom y)$ combine to a map
    \[ g_1\colon X^1 \to \geom L \]
    (because \enquote{$\vee$} is the coproduct in the category of pointed
    spaces). Now we extend $g_1$ to~$X$. Since only parts of
    $\geom{K^{\leq 1}}$ are identified to a point by~$q$ we see that
    $X$ fits into a pushout diagram
    \[
        \xymatrix@R=0.5cm@C=1.2cm{
            \coprod_{j=1}^\ell S^1 \ar[r]^-{\coprod_{j=1}^\ell \phi_j} \ar@{ `->}[d]
            & X^1 \ar[d]
            \\
            \coprod_{j=1}^\ell D^2 \ar[r]
            & X
            \rlap{,}
        }
    \]
    where $\ell\in\N$ is the number of $2$-simplices of~$K$. Fix
    $j\in\setOneto{\ell}$. Then
    \[
        [\phi_j]_\ast = [\gamma]_\ast \cdot [\gamma']_\ast \cdot [\gamma'']_\ast
        \;\in\,\pi_1(X,[x_0])
    \]
    where $\gamma,\gamma',\gamma''$ correspond to the three $1$-dimensional
    faces of the original $2$-simplex of~$K$, so each of those is either
    the constant loop at~$[x_0]\in X$ or one of the loops~$\gamma_{j'}$.
    It is easy to see that $\phi_j$ is pointed contractible in~$X$ because
    it is the projected boundary loop of a $2$-simplex in~$\geom{K}$. The
    following calculation shows that $g_1\after\phi_j$ is pointed contractible
    in~$\geom L$ as well:
    \begin{align*}
        [g_1\after\phi_j]_\ast
        &= [g_1\after\gamma]_\ast \cdot [g_1\after\gamma']_\ast \cdot
            [g_1\after\gamma'']_\ast
        \\
        &= \psi([\gamma]_\ast) \cdot \psi([\gamma']_\ast) \cdot
            \psi([\gamma'']_\ast)
        \\
        &= \psi([\phi_j]_\ast) = \psi(1) = 1 \in \pi_1(L,y)
    ; \end{align*}
    in the second equality $[g_1\after\gamma]_\ast = \psi([\gamma]_\ast)$ (and
    likewise for $\gamma'$ and $\gamma''$) clearly holds if $\gamma$ is the
    constant loop and for $\gamma=\gamma_{j'}$ we have
    \[ [g_1\after\gamma_{j'}]_\ast = [\eta_{j'}]_\ast = \psi([\gamma_{j'}]_\ast)
    \]
    by definition of $g_1$ and $\eta_{j'}$. But if $g_1\after\phi_j\colon
    S^1\to\geom L$ is contractible it can be extended to a map $g_{2j}\colon
    D^2\to\geom L$.
    %
    Thus we obtain a commutative diagram
    \[
        \xymatrix@R=0.5cm@C=1.2cm{
            \coprod_{j=1}^\ell S^1 \ar[r]^-{\coprod_{j=1}^\ell \phi_j} \ar@{ `->}[d]
            & X^1 \ar[d] \ar@/^1pc/[rdd]^{g_1}
            \\
            \coprod_{j=1}^\ell D^2 \ar[r] \ar@/_1pc/[rrd]_{\coprod_{j=1}^\ell g_{2j}}
            & X \ar@{-->}[rd]^g
            \\
            & & \geom L
            \rlap{,}
        }
    \]
    and by virtue of the universal property of the pushout a map
    $g\colon X\to\geom L$ fitting into the diagram. The composition
    \[ f\defeq g\after q\colon \geom K\to\geom L \]
    is the desired map, because: the equivalence classes of the loops
    $\gamma_1,\dots,\gamma_k$ obviously generate~$\pi_1(X,[x_0])$ and $g$
    restricts to $g_1$ on~$X^1$, so $\pi(g) = \psi$; by functoriality of $\pi_1$
    and definition of $\psi$, it follows that $\pi_1(f) = \phi$.
    \\
\end{proof}


\section{Classification}
Our goal is to prove the following

\begin{thTheorem}[classification of loop agreement tasks]
    \label{ch3:classification}
    %
    Let $\Loop{K,\kappa}$ and $\Loop{L,\lambda}$ be loop agreement tasks.
    Then $\Loop{K,\kappa}$ implements $\Loop{L,\lambda}$ if and only if
    there exists a group homomorphism $\pi_1(K)\to\pi_1(L)$ mapping
    $[\kappa]$ to $[\lambda]$.
\end{thTheorem}


\section{Consequences}
\label{ch2:sec:consequences}
